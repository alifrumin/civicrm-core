# CiviCRM 5.2.0

Released June 6, 2018

- **[Synopsis](#synopsis)**
- **[Features](#features)**
- **[Bugs resolved](#bugs)**
- **[Miscellany](#misc)**
- **[Credits](#credits)**
- **[Feedback](#feedback)**

## <a name="synopsis"></a>Synopsis

| *Does this version...?*                                         |         |
|:--------------------------------------------------------------- |:-------:|
| Fix security vulnerabilities?                                   |         |
| Change the database schema?                                     |         |
| Alter the API?                                                  |         |
| Require attention to configuration options?                     |         |
| Fix problems installing or upgrading to a previous version?     |         |
| Introduce features?                                             |         |
| Fix bugs?                                                       |         |

## <a name="features"></a>Features

### Core CiviCRM

- **[CRM-21849](https://issues.civicrm.org/jira/browse/CRM-21849) Add Link To
  Edit Relationship Types
  ([11853](https://github.com/civicrm/civicrm-core/pull/11853))**

  This change adds a settings button next to the Relationship Type field on the
  Edit Relationship screen which allows you to edit relationship types.

### Dedupe

- **[CRM-21753](https://issues.civicrm.org/jira/browse/CRM-21753) Support
  'criteria' in url on batch merge form
  ([11658](https://github.com/civicrm/civicrm-core/pull/11658))**

  CiviCRM supports 'criteria' in batch merge - this PR ensures that if $criteria are in
  the url  on the find duplicates screen it is passed through to the merge
  function. This is part of the work towards extensionising dedupe functionality.

### CiviEvent

- **[CRM-20879](https://issues.civicrm.org/jira/browse/CRM-20879) Extend
  self-service event registration transfer to backend
  ([10695](https://github.com/civicrm/civicrm-core/pull/10695))**

  This change adds links to "Transfer or Cancel" an event registration when
  viewing an Event Registration for a participant and when viewing a contact's
  event registrations from the event tab on the contact's record.

## <a name="bugs"></a>Bugs resolved

### Core CiviCRM

- **[dev/core#98](https://lab.civicrm.org/dev/core/issues/98) Searching by any
  Address fields with location type other than primary throw DB error
  ([12081](https://github.com/civicrm/civicrm-core/pull/12081))**

  This change fixes a bug where when using Search Builder when a user picks an
  address field with a location type other than primary (Home for example),
  submit would result in a database error so that no fatal error is thrown and
  the correct results are shown.

- **[dev/core#91](https://lab.civicrm.org/dev/core/issues/91) Search Builder
  Improvements ([12058](https://github.com/civicrm/civicrm-core/pull/12058))**

   On the Search Builder screen, this change limits the MySql operators available
   based on the type of field (string, date etc.).

 - **Mark Accent String Tests as incomplete if on a database that is not utf8
   ([12060](https://github.com/civicrm/civicrm-core/pull/12060))**

   This PR fixes a bug where tests completely fail on latin1 test boxes so that
   tests are marked as incomplete rather than skipped.

- **Fix: Batch update participants with checkboxes fails ([12051](https://github.com/civicrm/civicrm-core/pull/12051))**

- **[dev/core#86](https://lab.civicrm.org/dev/core/issues/86) Notify admin when testing email if CIVICRM_MAIL_LOG_AND_SEND is set ([12037](https://github.com/civicrm/civicrm-core/pull/12037))**

- **Add unit test to event batch update (includes function extraction to support this) ([12048](https://github.com/civicrm/civicrm-core/pull/12048))**

- **[dev/core#90](https://lab.civicrm.org/dev/core/issues/90) Apply disabling Full Group By to reports ([12047](https://github.com/civicrm/civicrm-core/pull/12047), [12043](https://github.com/civicrm/civicrm-core/pull/12043))**

- **Remove usage of deprecated paymentProcessorType function ([12039](https://github.com/civicrm/civicrm-core/pull/12039))**

- **[dev/core#75](https://lab.civicrm.org/dev/core/issues/75) - warning message after an activity is created ([12027](https://github.com/civicrm/civicrm-core/pull/12027))**

- **[dev/core#73](https://lab.civicrm.org/dev/core/issues/73) - Add invoice number to bookkeeping report ([12020](https://github.com/civicrm/civicrm-core/pull/12020))**

- **Move help section outside the container ([12031](https://github.com/civicrm/civicrm-core/pull/12031))**

- **Translate strings in "Report" UI, et al ([12009](https://github.com/civicrm/civicrm-core/pull/12009))**

- **Add missing case type tests ([12023](https://github.com/civicrm/civicrm-core/pull/12023))**

- **[dev/core#70](https://lab.civicrm.org/dev/core/issues/70) On any custom search 'Print selected rows' action doesn't retain columns/values ([12010](https://github.com/civicrm/civicrm-core/pull/12010))**

- **Improve input handling in get-cases AJAX API ([12017](https://github.com/civicrm/civicrm-core/pull/12017))**

- **[dev/core#65](https://lab.civicrm.org/dev/core/issues/65) Fix issue where source for participant could be entered w… ([12014](https://github.com/civicrm/civicrm-core/pull/12014))**

- **Add New API Call To Get All Unique Fields For Given Entity ([11990](https://github.com/civicrm/civicrm-core/pull/11990))**

- **[CRM-19885](https://issues.civicrm.org/jira/browse/CRM-19885) Scheduled Reminders: lack of default form values leads to SQL syntax error ([11972](https://github.com/civicrm/civicrm-core/pull/11972))**

- **Standardise Address code in Contact summary report & enable links ([11993](https://github.com/civicrm/civicrm-core/pull/11993))**

- **[dev/translation#9](https://lab.civicrm.org/dev/translation/issues/9) Create API Action to rebuild Multilingual Schema ([11967](https://github.com/civicrm/civicrm-core/pull/11967))**

- **[dev/core#64](https://lab.civicrm.org/dev/core/issues/64) - In custom searches, column headings are being ignored ([12001](https://github.com/civicrm/civicrm-core/pull/12001))**

- **Fix the contact merge form on Drupal 8 ([11992](https://github.com/civicrm/civicrm-core/pull/11992))**

- **Namespace exception in test ([11986](https://github.com/civicrm/civicrm-core/pull/11986))**

- **Fix intermittant test bug ([11995](https://github.com/civicrm/civicrm-core/pull/11995))**

- **Fix select2 value updation for crmAddName Directive ([11979](https://github.com/civicrm/civicrm-core/pull/11979))**

- **[dev/financial#11](https://lab.civicrm.org/dev/financial/issues/11) email invoice fails with validation error ([11971](https://github.com/civicrm/civicrm-core/pull/11971))**

- **translate strings ([11988](https://github.com/civicrm/civicrm-core/pull/11988))**

- **[dev/core#48](https://lab.civicrm.org/dev/core/issues/48) Fix PDF Letter only generates a single letter when multiple contact IDs are specified ([11985](https://github.com/civicrm/civicrm-core/pull/11985))**

- **[dev/core#59](https://lab.civicrm.org/dev/core/issues/59) scheduled reminder email validation ([11973](https://github.com/civicrm/civicrm-core/pull/11973))**

- **E-notice fix ([11982](https://github.com/civicrm/civicrm-core/pull/11982))**

- **[CRM-20598](https://issues.civicrm.org/jira/browse/CRM-20598) Phone ext in profile edit messing with address ([11978](https://github.com/civicrm/civicrm-core/pull/11978))**

- **AllCoreTables - Generate file every time ([11755](https://github.com/civicrm/civicrm-core/pull/11755))**

- **Prevent hard-fail when section header / group by option chosen on logging report ([11953](https://github.com/civicrm/civicrm-core/pull/11953))**

- **[CRM-21855](https://issues.civicrm.org/jira/browse/CRM-21855) Editing "A" side of relationship copies values to "B" side ([11965](https://github.com/civicrm/civicrm-core/pull/11965))**

- **Add 'addToDeveloperTab' in more places to expose sql in use (permission limited) ([11947](https://github.com/civicrm/civicrm-core/pull/11947))**

- **Fix API template ([11970](https://github.com/civicrm/civicrm-core/pull/11970))**

- **core-54 - Activity created for case role relationship is not assigned… ([11960](https://github.com/civicrm/civicrm-core/pull/11960))**

- **Fix contribution detail report to work with FULL GROUP BY mode ([11954](https://github.com/civicrm/civicrm-core/pull/11954))**

- **Drupal8 loadBootStrap: fix user variable ([11958](https://github.com/civicrm/civicrm-core/pull/11958))**

- **Fix template for widget ([11902](https://github.com/civicrm/civicrm-core/pull/11902))**

- **[CRM-21523](https://issues.civicrm.org/jira/browse/CRM-21523) scheduled reminders: when using repetition, require frequency intervals ([11377](https://github.com/civicrm/civicrm-core/pull/11377))**

- **[dev/core#53](https://lab.civicrm.org/dev/core/issues/53) Add in stats to AB tests and add in clickthrough and open… ([11957](https://github.com/civicrm/civicrm-core/pull/11957))**

- **Extract custom data edit template code to shared template ([11950](https://github.com/civicrm/civicrm-core/pull/11950))**

- **Simple function extraction on editing Address (within main contact edit) ([11900](https://github.com/civicrm/civicrm-core/pull/11900))**

- **Fix typo in CIVICRM_MAIL_LOG_AND_SEND constants ([204](https://github.com/civicrm/civicrm-packages/pull/204))**

- **Allow KCFinder to send back a json encoded response instead of string… ([203](https://github.com/civicrm/civicrm-packages/pull/203))**

### CiviEvent

- **Fix Soft credit personal note ton limit to 255 characters (DB limit).
  ([12056](https://github.com/civicrm/civicrm-core/pull/12056))**

  This change fixes a bug where when a user is donating on a civiEvent Personal
  Campaign page and checks the "Show my support in public honor roll" and puts a
  message in the "Personal Note" box that is longer than 255 characters submit
  the donation processes but the page throws a fatal error before receipt is
  dispatched - so donor does not now monies went through by changing he DB limit
  for the field soft credit personal note.

- **[dev/core#60](https://lab.civicrm.org/dev/core/issues/60) Fix for check
  number no longer exposed dev/core/issues/60
  ([12059](https://github.com/civicrm/civicrm-core/pull/12059))**

  This change fixes a bug where the "Check number" was not showing on Pay Later
  event registrations when edited.

### CiviCase

- **[CRM-21843](https://issues.civicrm.org/jira/browse/CRM-21843) Case
  activities delimiter not working
  ([11961](https://github.com/civicrm/civicrm-core/pull/11961))**

  This change fixes a bug where when exporting Cases The last column would contain
  all the activity fields jammed together.

### CiviContribute

- **[dev/core#78](https://lab.civicrm.org/dev/core/issues/78) - Incorrect
  Payment Processor for Recurring Payments
  ([12030](https://github.com/civicrm/civicrm-core/pull/12030))**

  This PR fixes a bug where the incorrect payment processor was being used for
  recurring payments. The issue arose due to there being two AuthNet payment
  processors, one for both A1 and A2. And the CiviCRM code is (naively) written
  assuming there'd be a maximum of one. So when AuthNet calls into CiviCRM to
  notify it of a successful recurring payment, for the A1 payments it was loading
  the A2 payment processor — and then failing.

- **[dev/core#72](https://lab.civicrm.org/dev/core/issues/72) fix payflow bug
  for amount ([12019](https://github.com/civicrm/civicrm-core/pull/12019))**

  Fixes a bug where PayflowPro throws an error due to more than 4 decimal places
  in the amount.

- **[CRM-19752](https://issues.civicrm.org/jira/browse/CRM-19752) Slow query
  created by financial type acls
  ([11657](https://github.com/civicrm/civicrm-core/pull/11657))**

  This change is to improve Financial ACL code that was unnecessarily slowing down
  the contact dashboard on sites where Finacial ACL's are not enabled by making it
  so the Financial ACL join & condition is not added where financial acls are not
  enabled.

### CiviMail

- **[CRM-21194](https://issues.civicrm.org/jira/browse/CRM-21194) Unique clicks
  in mailing report shows duplicates
  ([10988](https://github.com/civicrm/civicrm-core/pull/10988))**

  Ensure Mailing Report displays unique URL clicks in a mailing and does not show
  the same person twice.

- **[CRM-21100](https://issues.civicrm.org/jira/browse/CRM-21100) Empty list
  shown in "Send test email to group" dropdown
  ([10898](https://github.com/civicrm/civicrm-core/pull/10898))**

  In the preview section of a mailing, the "Send test email to groups" dropdown
  showed an empty list by default. This change makes it so the list is now only
  populated by the current list of recipients, if any. It should list existing
  groups even though these are not chosen as recipients. Previously the Test Group
  box was generated using a list of groups put into the DOM. Now it works off an
  AJAX based API call in the same style as the Recipients box.

### WordPress Integration

- **[CRM-21564](https://issues.civicrm.org/jira/browse/CRM-21564) Changing from
  using exec to WP_CLI::Launch
  ([119](https://github.com/civicrm/civicrm-wordpress/pull/119))**

  This change moves from using exec to WP_CLI:: Launch because exec does not seem
  to be available on all systems it also makes the code more consistent for
  running external processes.

## <a name="misc"></a>Miscellany

- **[CRM-21037](https://issues.civicrm.org/jira/browse/CRM-21037) Add unit tests
  for Activity sendSMS functions
  ([10946](https://github.com/civicrm/civicrm-core/pull/10946))**

- **[CRM-21148](https://issues.civicrm.org/jira/browse/CRM-21148) Refactor
  "getFromTo()" functions
  ([11887](https://github.com/civicrm/civicrm-core/pull/11887))**

- **Fix (unreleased) regression on report pager
  ([12080](https://github.com/civicrm/civicrm-core/pull/12080))**

- **[NFC] FIx indenting in eventFees template
  ([12062](https://github.com/civicrm/civicrm-core/pull/12062))**

- **[NFC] Add metadata to describe personal note field
  ([12046](https://github.com/civicrm/civicrm-core/pull/12046))**

- **(NFC) Update version in header
  ([11999](https://github.com/civicrm/civicrm-core/pull/11999))**

- **[nfc]  Consistently specify whether to clean money when calling from test
  suite ([11959](https://github.com/civicrm/civicrm-core/pull/11959))**

- **(NFC) Update version in header
  ([530](https://github.com/civicrm/civicrm-drupal/pull/530))**

- **(NFC) Fix Warnings When Updating Custom Entities
  ([12033](https://github.com/civicrm/civicrm-core/pull/12033))**

- **(NFC) Update version headers in `xml`, `tests`, `tools`, et al
  ([12029](https://github.com/civicrm/civicrm-core/pull/12029))**

- **5.1 ([12018](https://github.com/civicrm/civicrm-core/pull/12018))**

- **[CRM-20459](https://issues.civicrm.org/jira/browse/CRM-20459) Actively
  deprecate CRM_Core_OptionGroup::getValue
  ([12049](https://github.com/civicrm/civicrm-core/pull/12049))**

  This change replaces all uses of the deprecated function
  CRM_Core_OptionGroup::getValue with  CRM_Core_Pseudoconstant::getKey.

- **Rename function enableFullGroupByMode to be reenableFullGroupByMode t…
  ([12064](https://github.com/civicrm/civicrm-core/pull/12064))**

- **Remove unused code in CRM_Contribute_Form_ContributionPage_Amount::formRule
  ([12054](https://github.com/civicrm/civicrm-core/pull/12054))**

## <a name="credits"></a>Credits

This release was developed by the following code authors:

AGH Strategies - Andrew Hunt; Australian Greens - Seamus Lee; CiviCoop - Jaap Jansma; CiviCRM - Coleman Watts, Tim Otten; CiviDesk - Yashodha Chaku; CompuCorp - Michael Devery, Mukesh Ram, René Olivo, Vinu Varshith Sekar; Coop SymbioTIC - Mathieu Lutfy, Samuel Vanhove; deb1990; Fuzion - Jitendra Purohit; JMA Consulting - Monish Deb; Lighthouse Design and Consulting - Brian Shaughnessy; Megaphone Technology Consulting - Jon Goldberg; MJW Consulting - Matthew Wire; myDropWizard - David Snopek; Progressive Technology Project - Jamie McClelland; TBSliver; Wikimedia Foundation - Eileen McNaughton

Most authors also reviewed code for this release; in addition, the following
reviewers contributed their comments:

aferreras; Australian Greens - Seamus Lee; Chris Burgess; Christian Wach; CiviCoop - Jaap Jansma, Klaas Eikelboom; civicrm-builder; CiviCRM - Coleman Watts; CiviDesk - Yashodha Chaku; CompuCorp - Michael Devery; Coop SymbioTIC - Mathieu Lutfy, Samuel Vanhove, Stéphane Lussier; deb1990; Donald Hirst; Fuzion - Peter Davis; gmcvo; JMA Consulting - Joe Murray, Monish Deb; Joinery - Allen Shaw; Left Join Labs - Sean Madsen; Lemniscus - Noah Miller; Lighthouse Design and Consulting - Brian Shaughnessy; Megaphone Technology Consulting - Jon Goldberg; MJW Consulting - Matthew Wire; myDropWizard - David Snopek; Nubay Services - David Tarrant; Pradeep Nayak; Progressive Technology Project - Jamie McClelland; Semper IT - Karin Gerritsen; small biz; Tadpole Collective - Kevin Cristiano; TBSliver; Third Sector Design - Michael McAndrew; Wikimedia Foundation - Eileen McNaughton

## <a name="feedback"></a>Feedback

These release notes are edited by Alice Frumin and Andrew Hunt.  If you'd like
to provide feedback on them, please login to https://chat.civicrm.org/civicrm
and contact `@agh1`.
