# CiviCRM 5.0.0

Released April 4, 2018;

- **[Features](#features)**
- **[Bugs resolved](#bugs)**
- **[Miscellany](#misc)**
- **[Credits](#credits)**

## <a name="features"></a>Features

### CiviCRM API

- **[CRM-21803](https://issues.civicrm.org/jira/browse/CRM-21803) Standardise
  ParticipantPayment api to support custom data
  ([11718](https://github.com/civicrm/civicrm-core/pull/11718))**

  The ParticipantPayment API now uses the standard api function, this has the
  added bonus of allowing this api to support custom data.

### Core CiviCRM

- **[CRM-21659](https://issues.civicrm.org/jira/browse/CRM-21659) Add hook to
  CRM_Utils_System::redirect ([11519](https://github.com/civicrm/civicrm-core/pull/11519))**

NOTE THIS PR HAS A BUNCH OF DOCUMENTATION ON IT MIGHT BE WORTH TALKING MORE ABOUT WHAT GUZZLE DOES? IM NOT SURE WHAT THIS LINE "The UriInterface from PSR-7 is included; the concrete implementation of Uri is loaded from Guzzle v6.3+." MEANS BUT IT SEEMS IMPORTANT

  Adds a hook (hook_civicrm_alterRedirect) when the browser is being redirected. This allows extensions to
  override the destination of an HTTP redirect.

  The UriInterface from PSR-7 is included; the concrete implementation of Uri is loaded from Guzzle v6.3+.

- **[CRM-21391](https://issues.civicrm.org/jira/browse/CRM-21391) Refactor tasks
  to use a base class
  ([11808](https://github.com/civicrm/civicrm-core/pull/11808),
  [11761](https://github.com/civicrm/civicrm-core/pull/11761),
  [11762](https://github.com/civicrm/civicrm-core/pull/11762),
  [11763](https://github.com/civicrm/civicrm-core/pull/11763),
  [11760](https://github.com/civicrm/civicrm-core/pull/11760),
  [11759](https://github.com/civicrm/civicrm-core/pull/11759),
  [11758](https://github.com/civicrm/civicrm-core/pull/11758),
  [11692](https://github.com/civicrm/civicrm-core/pull/11692), and
  [11693](https://github.com/civicrm/civicrm-core/pull/11693))**

NOTE THIS IS A BIG CHANGE CODE WISE BUT MOSTLY KEEPS THINGS WORKING THE SAME... I THINK IT COULD BELONG IN THE BUG SECTION

  Refactors all the component tasks so they are extend a new base class
  CRM_Core_Task.

  This change cleans up the code and uses shared code where possible. It also
  fixes a few bugs specifically, there were a number of issues with the "Advanced
  Search" when switching between component types where the task list would be
  populated with the wrong list of tasks, but the keys would trigger an action on
  the selected component and an unexpected action may occur and there was also a
  bug where when saving group_type mailing_list was always being checked.


- **[CRM-21777](https://issues.civicrm.org/jira/browse/CRM-21777) Improve the
  messaging related to Directories and Resources
  ([11802](https://github.com/civicrm/civicrm-core/pull/11802) and
  [11680](https://github.com/civicrm/civicrm-core/pull/11680))**

NOTE IM ON THE FENCE IF THIS IS A FEATURE OR A BUG

  This change makes it so when on the admin pages Directory Preference OR Resource
  URL fields initialized in civicrm.settings.php are loaded as readonly. Prior to
  this change the fields were being loaded as editable but the values were not
  being saved because they were being overridden by the values in the
  civicrm.settings.php file). This change also adds a warning which lets the user
  know that some fields are already set (overridden) in settings file.

- **[crm-](https://issues.civicrm.org/jira/browse/crm-)  ([11775](https://github.com/civicrm/civicrm-core/pull/11775), [11699](https://github.com/civicrm/civicrm-core/pull/11699), [11695](https://github.com/civicrm/civicrm-core/pull/11695), [11682](https://github.com/civicrm/civicrm-core/pull/11682), and [11677](https://github.com/civicrm/civicrm-core/pull/11677))**

NOTE THIS ONE IS BROKEN NOT SURE WHY NOT TOUCHING

### CiviCase

- **[CRM-21558](https://issues.civicrm.org/jira/browse/CRM-21558) Add batch
  update via profile to cases
  ([11411](https://github.com/civicrm/civicrm-core/pull/11411))**

  This change adds a "Update Multiple Cases" option to search tasks and allows you to batch
  update multiple cases in the same way as other entities.

### CiviContribute

- **[CRM-20610](https://issues.civicrm.org/jira/browse/CRM-20610) Replace
  payment details block with editable payment list on 'Edit Contribution' form
  ([11748](https://github.com/civicrm/civicrm-core/pull/11748)) (preliminary
  work)**

  This change makes it possible via hook or by changing core to switch to using
  the payment form on the 'Edit Contribution' form for payments without actually
  making that change.

### CiviMail

- **[CRM-21576](https://issues.civicrm.org/jira/browse/CRM-21576) Implement Send
  SMS permission ([11590](https://github.com/civicrm/civicrm-core/pull/11590))**

  This change adds a permission to Send SMS. More specifically, it: Adds the Send SMS
  permission to CRM_Core_Permissions::getCorePermissions, ensures that all
  navigation menu entries ('Find SMS' and 'New SMS') respect the new permission,
  Ensures that all paths (civicrm/sms/send, civicrm/activity/sms/add,
  civicrm/mailing) respect the new permission, Only show 'Outbound SMS' action
  from the action menu on the contact screen to users with the send SMS
  permission, and only shows 'SMS - schedule/send' from the advanced search
  actions to users with the send SMS permission.

- **[CRM-21405](https://issues.civicrm.org/jira/browse/CRM-21405) Allow
  "Outbound SMS" when Mobile is not primary phone number
  ([11252](https://github.com/civicrm/civicrm-core/pull/11252))**

  This change makes it so when a contact has a mobile phone number but it is not
  the primary number the "Outbound SMS" action is allowed, and usees the first
  available mobile number from the contact.

- **[CRM-21140](https://issues.civicrm.org/jira/browse/CRM-21140) Agree & (if
  applicable) implement approach to storing extension data for entities / tables
  ([11608](https://github.com/civicrm/civicrm-core/pull/11608))**

  This change makes it possible to extend Mailing with Custom data by making it
  so the Mailing api supports custom data. This is primarily for the benefit of
  extension writers.

### CiviMember

- **[CRM-21733](https://issues.civicrm.org/jira/browse/CRM-21733) Allow
  overriding membership status temporarily until specific date
  ([11722](https://github.com/civicrm/civicrm-core/pull/11722) and
  [11622](https://github.com/civicrm/civicrm-core/pull/11622))**

  When overriding a membership status this change provides extra options to allow
  a temporary status override.

  Instead of having a checkbox called (Override Status?) in membership
  add/edit/renew form, it is replaced with a select box that allow the user to
  choose one of three options: No, Override Permanently or Override until selected
  date.

  If the first option is selected, then the membership will behave as if the old
  (Override Status?) is *unchecked*, which means that the membership is subject to
  membership status rules.

  If the 2nd option is selected, then the membership will behave as if the old
  (Override Status?) is *checked*, which mean that the membership status is
  overridden and is not subject to the membership statues rules.

  If the 3rd option is selected, then a new field will appear allowing the user to
  choose a date, in this status, the membership will behave similar to option 2,
  but when today date is equal or less than the selected date, then the "Update
  Membership Statuses" scheduled job will automatically convert its status back to
  *No*, which means that the membership status is overridden temporarily only for
  the selected date and after that it will revert back and be subject to
  membership status rules.

### CiviCRM Search

- **[CRM-21810](https://issues.civicrm.org/jira/browse/CRM-21810) improve
  changelog search panel UI
  ([11729](https://github.com/civicrm/civicrm-core/pull/11729))**

  This change improve the change log panel in Advanced Search UI. It places the
  added/modified radio buttons at the top and moves the two search fields side by
  side to make the layout more logical and to make better use of the space.

### Internationalisation

- **[CRM-21765](https://issues.civicrm.org/jira/browse/CRM-21765) Commit files
  to git which are static but are generated from CodeGen like DAO files
  ([11667](https://github.com/civicrm/civicrm-core/pull/11667))**

  Add SchemaStructure.php and langs.php files (which are static but generated from
  CodeGen) to git, reducing the need to run GenCode.

## <a name="bugs"></a>Bugs resolved

### Core CiviCRM

- **[CRM-21830](https://issues.civicrm.org/jira/browse/CRM-21830) State/Province
  tokens are not working as expected in address settings for billing address
  ([11776](https://github.com/civicrm/civicrm-core/pull/11776))**

  When the 'state_province_name' token was used (in address settings), the
  state/province was empty when 'Billing Address' was displayed. This change
  makes it so when the 'state_province_name' token is used in address settings
  the token is populated when the billing address is displayed

- **[CRM-21781](https://issues.civicrm.org/jira/browse/CRM-21781) Don't crash if
  contact ID not found when viewing contact
  ([11690](https://github.com/civicrm/civicrm-core/pull/11690))**

  In various situations if one ended up at civicrm/contact/view without URL
  parameters (for example logging back in after session expiry) a fatal error was
  thrown.

  This change makes it so that instead of throwing a fatal error one is bounced
  back to the Civi dashboard, improving the user experience.

- **[CRM-21826](https://issues.civicrm.org/jira/browse/CRM-21826) Default FROM
  Email Address (for system-generated emails) link incorrect in System Status
  Screen ([11756](https://github.com/civicrm/civicrm-core/pull/11756))**

  This updates the System Status Screen to have separate links for Domain Name and From
  Email Address.

- **Fix page layout for wordpress (dev/core/issues/21) ([11827](https://github.com/civicrm/civicrm-core/pull/11827))**

- **Activity Form - Fix recently introduced warning ([11815](https://github.com/civicrm/civicrm-core/pull/11815))**

- **Add pre and post hooks to the Survey entity ([11813](https://github.com/civicrm/civicrm-core/pull/11813))**

- **Fix transaction template ([11811](https://github.com/civicrm/civicrm-core/pull/11811))**

- **dev/release/1 - Change numbering to 5.x.x ([11704](https://github.com/civicrm/civicrm-core/pull/11704))**

- **Fix relationshipType, paymentProcessorType, Note & jobLog apis to support custom data ([11721](https://github.com/civicrm/civicrm-core/pull/11721))**

- **Fix html template structure with classes, divs & tags ([11796](https://github.com/civicrm/civicrm-core/pull/11796))**

- **Add test for api money, fix net_amount calc ([11801](https://github.com/civicrm/civicrm-core/pull/11801))**

- **Remove hacks from CRM_Core_Menu for old unsupported versions ([11781](https://github.com/civicrm/civicrm-core/pull/11781))**

- **E-notice fix. ([11799](https://github.com/civicrm/civicrm-core/pull/11799))**

- **[CRM-21667](https://issues.civicrm.org/jira/browse/CRM-21667) Bad timezone hand-off from CMS to CRM ([11800](https://github.com/civicrm/civicrm-core/pull/11800))**

- **[CRM-20608](https://issues.civicrm.org/jira/browse/CRM-20608) IPN thinks Paypal Pro is Standard ([11777](https://github.com/civicrm/civicrm-core/pull/11777))**

- **dev/financial/5 If a currency has been disabled allow the form to be submitted ([11795](https://github.com/civicrm/civicrm-core/pull/11795))**

- **Update test to NOT accept a failure in the api call. ([11798](https://github.com/civicrm/civicrm-core/pull/11798))**

- **[CRM-21756](https://issues.civicrm.org/jira/browse/CRM-21756) Editing Contribution (total_amount) does -not- update LineItem (line_total) ([11780](https://github.com/civicrm/civicrm-core/pull/11780))**

- **[CRM-21806](https://issues.civicrm.org/jira/browse/CRM-21806) Search builder returns no results ([11769](https://github.com/civicrm/civicrm-core/pull/11769), [11751](https://github.com/civicrm/civicrm-core/pull/11751), and [11746](https://github.com/civicrm/civicrm-core/pull/11746))**

- **dev/core#12: Added auto-scroll-up functionality between steps to crmUiWizard ([11790](https://github.com/civicrm/civicrm-core/pull/11790))**

- **Fix style glitches ([11792](https://github.com/civicrm/civicrm-core/pull/11792))**

- **Make template structure proper ([11788](https://github.com/civicrm/civicrm-core/pull/11788))**

- **Fix template structure ([11779](https://github.com/civicrm/civicrm-core/pull/11779))**

- **Add 'huge' class to html textarea to match plaintext textarea ([11770](https://github.com/civicrm/civicrm-core/pull/11770))**

- **[CRM-21819](https://issues.civicrm.org/jira/browse/CRM-21819) Do not load "Submit Credit Card Contribution" button for invalid processors. ([11757](https://github.com/civicrm/civicrm-core/pull/11757))**

- **ensure correct payment_instrument_id ([11768](https://github.com/civicrm/civicrm-core/pull/11768))**

- **Update minimum php version to 5.5 ([11453](https://github.com/civicrm/civicrm-core/pull/11453))**

- **Fixed template structure issues ([11766](https://github.com/civicrm/civicrm-core/pull/11766))**

- **Fix upgrade failures from zero value `trxn_date` ([11745](https://github.com/civicrm/civicrm-core/pull/11745))**

- **CKEditor Advanced Options - Better validation of options ([11752](https://github.com/civicrm/civicrm-core/pull/11752))**

- **[CRM-21823](https://issues.civicrm.org/jira/browse/CRM-21823) Change position of help div and fix structure glitches ([11750](https://github.com/civicrm/civicrm-core/pull/11750))**

- **CKEditorConfig - Fix double-escaped slashes ([11747](https://github.com/civicrm/civicrm-core/pull/11747))**

- **[CRM-21817](https://issues.civicrm.org/jira/browse/CRM-21817) Move help section outside crm block as per other pages ([11738](https://github.com/civicrm/civicrm-core/pull/11738))**

- **(release/1) Allow set-version.php to generate upgraders for major/minor increments ([11731](https://github.com/civicrm/civicrm-core/pull/11731))**

- **ensure pdfFilename is set ([11702](https://github.com/civicrm/civicrm-core/pull/11702))**

- **[CRM-21795](https://issues.civicrm.org/jira/browse/CRM-21795) Fatal error: civicrm/CRM/Utils/System/Drupal.php on line 857 ([11712](https://github.com/civicrm/civicrm-core/pull/11712))**

- **CiviReport - Check for trueish values of the parameter 'required' ([11725](https://github.com/civicrm/civicrm-core/pull/11725))**

- **Update to PHPWord 0.14.0 ([11696](https://github.com/civicrm/civicrm-core/pull/11696))**

- **[CRM-21805](https://issues.civicrm.org/jira/browse/CRM-21805) Fix structure for search pages in find participant ([11723](https://github.com/civicrm/civicrm-core/pull/11723))**

- **Crm 21693 show Display Name in online pay now UI ([11571](https://github.com/civicrm/civicrm-core/pull/11571))**

- **Throw exception instead of using fatal ([11719](https://github.com/civicrm/civicrm-core/pull/11719))**

- **Fix more entities to support custom fields (via api) ([11688](https://github.com/civicrm/civicrm-core/pull/11688))**

- **Move towards standardising website.create function. ([11694](https://github.com/civicrm/civicrm-core/pull/11694))**

- **[CRM-21778](https://issues.civicrm.org/jira/browse/CRM-21778) Contact image uploaded from drupal webform don't render on summary page ([11681](https://github.com/civicrm/civicrm-core/pull/11681))**

- **/civicrm/upgrade - On finish screen, display actual version number ([11705](https://github.com/civicrm/civicrm-core/pull/11705))**

- **Deduper - Pass arrays rather than strings to construct URLs ([11671](https://github.com/civicrm/civicrm-core/pull/11671))**

- **Fix wrong tag defintion ([11698](https://github.com/civicrm/civicrm-core/pull/11698))**

- **Fix GroupNesting, GroupOrganization, Domain to work with singleValueAlter ([11689](https://github.com/civicrm/civicrm-core/pull/11689))**

- **composer.json - De-fork dependency, marcj/topsort ([11687](https://github.com/civicrm/civicrm-core/pull/11687))**

- **Ignore errors when upgrade step already took place ([11685](https://github.com/civicrm/civicrm-core/pull/11685))**

- **Add/Edit Contact - Fix inconsistent capitalization ([11675](https://github.com/civicrm/civicrm-core/pull/11675))**

### CiviCase

- **[CRM-21789](https://issues.civicrm.org/jira/browse/CRM-21789) 'Find Case'
  group by issue ([11706](https://github.com/civicrm/civicrm-core/pull/11706))**

  This ensures that when searching cases the count of cases found is accurate.

### Internationalisation

- **[CRM-21837](https://issues.civicrm.org/jira/browse/CRM-21837) Missing states for Gabon ([11793](https://github.com/civicrm/civicrm-core/pull/11793))**

### Dedupe

- **[CRM-21766](https://issues.civicrm.org/jira/browse/CRM-21766) Dedupe screen
  gives inappropriate confirm message when clicking on batch dedupe
  ([11670](https://github.com/civicrm/civicrm-core/pull/11670))**

  After doing a batch merge which resulted in a screen of conflicts, if you were
  to click on 'refresh list' you got a 'Do you want to leave this site? Changes
  you made may not be saved.' popup. This change removes that popup as there was
  nothing to edit.

- **[CRM-21773](https://issues.civicrm.org/jira/browse/CRM-21773) CRM-20858 breaks merging multi-value custom groups ([11691](https://github.com/civicrm/civicrm-core/pull/11691))**

### CiviReport

- **[CRM-20554](https://issues.civicrm.org/jira/browse/CRM-20554) Error when running activity report ([11630](https://github.com/civicrm/civicrm-core/pull/11630))**

### CiviEvent

- **[CRM-21639](https://issues.civicrm.org/jira/browse/CRM-21639) Event pages
  should be set to NoIndex when event is not public or in the past
  ([11496](https://github.com/civicrm/civicrm-core/pull/11496) and
  [11498](https://github.com/civicrm/civicrm-core/pull/11498))**

  This change makes it so that the CiviCRM Print Preview pages are not indexed
  by search engines and this change makes sure Event Info pages are not indexed
  by search engines when the event is not public.

- **[CRM-21814](https://issues.civicrm.org/jira/browse/CRM-21814) Add proper container to text ([11735](https://github.com/civicrm/civicrm-core/pull/11735))**

- **[CRM-21770](https://issues.civicrm.org/jira/browse/CRM-21770) Change position of help div in export participants ([11678](https://github.com/civicrm/civicrm-core/pull/11678))**

### NYSS

- **[CRM-21809](https://issues.civicrm.org/jira/browse/CRM-21809) 'Advance search' group by issue ([11728](https://github.com/civicrm/civicrm-core/pull/11728))**

### CiviCampaign

- **[CRM-21797](https://issues.civicrm.org/jira/browse/CRM-21797) Change Structure for Campaign search forms ([11714](https://github.com/civicrm/civicrm-core/pull/11714))**

### CiviMember

- **[CRM-20421](https://issues.civicrm.org/jira/browse/CRM-20421) CIVICRM-552 Inherited memberships are converted to individual memberships when the "parent" for the membership is merged with another contact ([11154](https://github.com/civicrm/civicrm-core/pull/11154))**

### CiviCRM API

- **[CRM-21792](https://issues.civicrm.org/jira/browse/CRM-21792) Regression: Extension API cannot filter on status in get request ([11709](https://github.com/civicrm/civicrm-core/pull/11709))**

### CiviContribute, CiviEvent

- **[CRM-21771](https://issues.civicrm.org/jira/browse/CRM-21771) error when viewing event registration with linked contribution ([11707](https://github.com/civicrm/civicrm-core/pull/11707))**

### CiviEvent, Core CiviCRM

- **[CRM-21708](https://issues.civicrm.org/jira/browse/CRM-21708) Make structure proper by adding/removing appropriate classes ([11585](https://github.com/civicrm/civicrm-core/pull/11585))**

## <a name="misc"></a>Miscellany

- **[CRM-21720](https://issues.civicrm.org/jira/browse/CRM-21720) Cleanup search
  classes to use enumerators instead of hardcoded values
  ([11600](https://github.com/civicrm/civicrm-core/pull/11600))**

- **[CRM-21739](https://issues.civicrm.org/jira/browse/CRM-21739) Create unit
  test for getRecipients include/exclude recipient groups
  ([11642](https://github.com/civicrm/civicrm-core/pull/11642))**

- **[CRM-21787](https://issues.civicrm.org/jira/browse/CRM-21787) Simplify
  CRM_Utils_System::version() to fetch version directly from xml/version.xml
  ([11700](https://github.com/civicrm/civicrm-core/pull/11700))**

- **(NFC) Update copyright header for 2018
  ([522](https://github.com/civicrm/civicrm-drupal/pull/522))**

- **(NFC) Update copyright header for 2018
  ([124](https://github.com/civicrm/civicrm-wordpress/pull/124))**

- **(NFC) Update copyright header for 2018
  ([45](https://github.com/civicrm/civicrm-joomla/pull/45))**

- **(NFC) Remove redundant line, improve docblocks
  ([11742](https://github.com/civicrm/civicrm-core/pull/11742))**

- **(NFC) remove starting whitespace in ts about installments
  ([11701](https://github.com/civicrm/civicrm-core/pull/11701))**

- **(NFC) Rename fiterable fields param in _civicrm_api3_basic_array_get …
  ([11711](https://github.com/civicrm/civicrm-core/pull/11711))**

- **(NFC) Update copyright header for 2018
  ([11713](https://github.com/civicrm/civicrm-core/pull/11713))**

- **(NFC) MembershipRenewal.php - Fix civilint error
  ([11717](https://github.com/civicrm/civicrm-core/pull/11717))**

- **[NFC] Update xml/templates/* headers
  ([11740](https://github.com/civicrm/civicrm-core/pull/11740))**

- **NFC - Minor code cleanup in CKEditorConfig.php
  ([11774](https://github.com/civicrm/civicrm-core/pull/11774))**

## <a name="credits"></a>Credits

This release was developed by the following code authors:

AGH Strategies - Andrew Hunt; Agileware - Alok Patel; Australian Greens - Seamus Lee; CiviCRM - Coleman Watts, Tim Otten; CiviDesk - Yashodha Chaku; CompuCorp - Mukesh Ram, Omar Abu Hussein; Coop SymbioTIC - Samuel Vanhove; cor73x; Fuzion - Jitendra Purohit; Ginkgo Street Labs - Frank Gómez; JMA Consulting - Monish Deb; John Kingsnorth; Joinery - Allen Shaw; Left Join Labs - Sean Madsen; Lighthouse Design and Consulting - Brian Shaughnessy; MJW Consulting - Matthew Wire; myDropWizard - David Snopek; Oxfam Germany - Thomas Schüttler; Progressive Technology Project - Jamie McClelland; reneolivo; Systopia - Björn Endres; Tadpole Collective - Kevin Cristiano; Third Sector Design - Michael McAndrew; vinuvarshith; Wikimedia Foundation - Eileen McNaughton

Most authors also reviewed code for this release; in addition, the following
reviewers contributed their comments:

adam-devapp; AGH Strategies - Andrew Hunt; Agileware - Agileware Team; Artful Robot - Rich Lott; Australian Greens - Seamus Lee; Blackfly Solutions - Alan Dixon; civicrm-builder; CiviCRM - Coleman Watts, Tim Otten; CiviDesk - Nicolas Ganivet, Yashodha Chaku; CompuCorp - Jamie Novick, Mukesh Ram, Omar Abu Hussein; Coop SymbioTIC - Mathieu Lutfy; Daniël van Vuuren; Freeform Solutions - Herb van den Dool; Fuzion - Jitendra Purohit, Peter Davis; Ginkgo Street Labs - Frank Gómez; JMA Consulting - Joe Murray, Monish Deb; John Kingsnorth; Joinery - Allen Shaw; KristineC; Lighthouse Design and Consulting - Brian Shaughnessy; maitrepylos; MC3 - Graham Mitchell; Megaphone Technology Consulting - Jon Goldberg; MJW Consulting - Matthew Wire; myDropWizard - David Snopek; n3o; Oxfam Germany - Thomas Schüttler; Progressive Technology Project - Jamie McClelland; ptreadaway; Richard van Oosterhout; Semper IT - Karin Gerritsen; Systopia - Björn Endres; Tadpole Collective - Kevin Cristiano; Third Sector Design - Michael McAndrew; Vinu Varshith Sekar; Wikimedia Foundation - Eileen McNaughton
